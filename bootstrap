#!/bin/sh

# parse arguments and set defaults
REPODIR="$HOME/.config/dotfiles"
DOTBACKUP="${REPODIR}-backup"
REMOTE='https://github.com/bepoli/dotfiles'
while getopts 'd:r:' opt; do
    case "$opt" in
        'd')
            REPODIR="$OPTARG"
            ;;
        'r')
            REMOTE="$OPTARG"
            ;;
    esac
done

# initialize dotfiles
git clone --bare "$REMOTE" "$REPODIR"
alias config='git --git-dir="$REPODIR" --work-tree="$HOME"'
mkdir -p "$DOTBACKUP"
for f in $(config ls-files); do
    if [ -f "$f" ]; then
        mkdir -p "$(dirname $f)"
        mv -f "$f" "$DOTBACKUP"/$f
    fi
done
config sparse-checkout set --no-cone '/**' '!bootstrap' '!README.md' '!LICENSE'
config config --local status.showUntrackedFiles no
unset REPODIR DOTBACKUP REMOTE
